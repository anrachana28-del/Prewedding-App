<!DOCTYPE html>
<html lang="km">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Open Wedding App</title>
  <meta name="theme-color" content="#ff4da6" />
  <style>
    :root {
      --pink:#ff4da6;
      --rose:#c71585;
      --bg:#fff0f6;
    }
    *{box-sizing:border-box}
    body{
      font-family:-apple-system,Khmer OS Battambang,"Segoe UI",Roboto,Arial,sans-serif;
      margin:0; padding:32px 20px;
      min-height:100vh;
      background: linear-gradient(135deg,#ffe6f0,#fff5fa);
      overflow-x:hidden; display:flex; flex-direction:column;
      align-items:center; gap:18px;
      color:#3a3a3a;
    }
    h1{color:var(--rose); margin:6px 0 0}
    p.lead{margin:0; color:#7a2b54}
    .card{
      width:100%; max-width:680px;
      background:#fff; border-radius:20px;
      box-shadow:0 10px 25px rgba(0,0,0,.08);
      padding:20px;
    }
    .actions{display:flex; gap:12px; flex-wrap:wrap; justify-content:center; margin-top:6px}
    .btn{
      background:var(--pink); color:#fff;
      border:none; border-radius:12px;
      padding:12px 18px; font-size:16px; cursor:pointer;
      box-shadow:0 6px 16px rgba(255,77,166,.35);
      transition:.2s transform ease,.2s box-shadow ease, background .2s;
    }
    .btn:hover{ transform:translateY(-1px); box-shadow:0 8px 20px rgba(255,77,166,.45); }
    .btn.secondary{ background:#eee; color:#444; box-shadow:none; }
    .hint{font-size:13px; color:#7a2b54; text-align:center; margin-top:6px}

    /* Notice / guide */
    .notice{
      display:none; margin-top:10px; padding:14px;
      background:#ffe6f0; color:#7a2b54; border-radius:14px;
    }
    .notice h3{margin:0 0 8px; color:var(--rose)}
    .notice ol{margin:8px 0 0 18px; padding:0}
    .notice code{
      background:#f6f6f6; padding:2px 6px; border-radius:6px; font-family:ui-monospace, monospace;
    }
    .row{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    .small{font-size:12px; opacity:.9}

    /* Loading overlay */
    .overlay{
      display:none; position:fixed; inset:0; z-index:9999;
      background:rgba(255,240,246,.96);
      align-items:center; justify-content:center; flex-direction:column; gap:14px;
      color:var(--rose); text-align:center;
    }
    .loader{
      position:relative; width:120px; height:120px; display:grid; place-items:center;
      filter: drop-shadow(0 0 8px rgba(255,77,166,.5));
    }
    .loader::before{
      content:""; position:absolute; inset:0;
      border-radius:50%;
      border:4px solid transparent;
      border-top-color:var(--pink);
      border-right-color:var(--pink);
      animation:spin 1.4s linear infinite;
      box-shadow:0 0 18px rgba(255,77,166,.6), inset 0 0 10px rgba(255,77,166,.15);
    }
    @keyframes spin{ to { transform:rotate(360deg) } }

    /* Loader beating hearts */
    .heart-pair{display:flex; gap:14px; align-items:center; justify-content:center}
    .heart-icon{
      font-size:46px;
      animation:beat 900ms ease-in-out infinite alternate;
      text-shadow:0 0 12px rgba(255,77,166,.45);
    }
    .heart-icon:nth-child(2){ animation-delay:.45s }
    @keyframes beat{ from{ transform:scale(1); opacity:.75 } to{ transform:scale(1.35); opacity:1 } }

    /* Troubleshoot */
    details{ margin-top:10px }
    summary{ cursor:pointer; color:#444 }
    ul.check{ margin:8px 0 0 16px }

    /* Floating hearts background */
    .heart-float {
      position:absolute;
      width:18px; height:18px;
      background:pink;
      transform:rotate(45deg);
      border-radius:2px;
      opacity:0.7;
      animation: floatUp 10s linear infinite;
    }
    .heart-float::before,
    .heart-float::after {
      content:"";
      position:absolute;
      width:18px; height:18px;
      background:pink;
      border-radius:50%;
    }
    .heart-float::before { top:-9px; left:0; }
    .heart-float::after { top:0; left:-9px; }

    @keyframes floatUp {
      0% { transform:translateY(100vh) scale(0.5) rotate(45deg); opacity:0; }
      30% { opacity:1; }
      100% { transform:translateY(-10vh) scale(1.2) rotate(45deg); opacity:0; }
    }

    /* Hearts container sits behind everything */
    #hearts-container {
      position:fixed;
      inset:0;
      z-index:0;
      pointer-events:none;
      overflow:hidden;
    }
  </style>
</head>
<body>
  <div id="hearts-container"></div>

  <img alt="Rings" src="data:image/svg+xml;utf8,<?xml version='1.0' encoding='UTF-8'?><svg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 24 24' fill='%23ffbfdf'><path d='M17 7h-2l1-2-2-2-2 2 1 2H8l1.879 1.879A6.99 6.99 0 0 0 7 15a7 7 0 1 0 7-7c-.717 0-1.404.122-2.044.346L17 7zM9 20a5 5 0 1 1 0-10 5 5 0 0 1 0 10zm10-1a5 5 0 0 1-3.536-8.536A5 5 0 1 1 19 19z'/></svg>" />
  <h1>ស្វាគមន៍មកកាន់</h1>
  <p class="lead">ជ្រើសរើសបង្ហាញ App ក្នុង Web ឬដំឡើងជា App Wedding នៅលើឧបករណ៍របស់អ្នក។</p>

  <div class="card">
    <div class="actions">
      <button id="openBtn" class="btn">Open Web</button>
      <button id="installBtn" class="btn">Install App</button>
      <a id="openInChromeLink" class="btn secondary" href="#" rel="noopener">Open in Chrome</a>
    </div>
    <div class="hint">URL App ៖ <code id="appLinkText">https://anrachana28-del.github.io/Prewedding-App/</code></div>

    <!-- iOS Add-to-Home-Screen guide -->
    <div id="iosGuide" class="notice">
      <h3>📱 How to Add to Home Screen (iOS)</h3>
      <ol>
        <li>បើកនៅក្នុង <b>Safari ឬ Chrome</b></li>
        <li>ចុច <b>Share</b> (⬆️) នៅខាងក្រោម</li>
        <li>ស្វែងរក ហើយជ្រើស <b>Add to Home Screen</b></li>
        <li>ចុច <b>Add</b> ✅</li>
      </ol>
      <div class="row small" style="margin-top:8px">
        <span>👉 ប្រសិនបើកំពុងនៅ Chrome (iOS) អាចសាកល្បងបើកក្នុង Chrome តាមនេះ៖</span>
        <a id="iosChromeDeepLink" class="btn secondary" style="padding:6px 10px">Open this URL in Chrome</a>
      </div>
      <div class="row small">
        <span>ឬ Copy link ៖</span>
        <code id="copyable">https://anrachana28-del.github.io/Prewedding-App/</code>
        <button id="copyBtn" class="btn secondary" style="padding:6px 10px">Copy</button>
        <div>
          <img src="image1.PNG" alt="Safari instruction screenshot 1" style="width:285px; height:500px;"/>
        </div>
        <div>
          <img src="image2.PNG" alt="Safari instruction screenshot 2" style="width:285px; height:500px;"/>
        </div>
      </div>
    </div>

    <!-- Troubleshoot -->
    <details id="troubleshoot" style="display:none">
      <summary>Why can’t I see the Install popup?</summary>
      <ul class="check">
        <li>✅ App URL ត្រូវបំពេញ <code>manifest.json</code> និង <code>service worker</code></li>
        <li>✅ មិននៅក្នុង Incognito / InPrivate</li>
        <li>✅ មិនបានដំឡើងរួចហើយ</li>
        <li>✅ បើកជាយូរបន្តិច និង interacted មួយចំនួន</li>
        <li>✅ Chrome/Edge/Brave ជំនាន់ថ្មី</li>
      </ul>
    </details>
  </div>

  <!-- Loading overlay -->
  <div class="overlay" id="overlay">
    <div class="loader">
      <div class="heart-pair">
        <div class="heart-icon">❤️</div>
        <div class="heart-icon">❤️</div>
      </div>
    </div>
    <div>⏳ កំពុងដំណើរការ…</div>
  </div>

  <script>
    // --- Config ---
    const APP_URL = "https://anrachana28-del.github.io/Prewedding-App/";

    // --- Helpers ---
    const $ = (s)=>document.querySelector(s);
    const overlay = $("#overlay");
    const showOverlay = (on=true)=> overlay.style.display = on ? "flex" : "none";
    const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
    const isAndroid = /android/i.test(navigator.userAgent);

    // open in Chrome deep-link (iOS only)
    const IOS_CHROME_LINK = "googlechrome://" + APP_URL.replace(/^https?:\/\//,'');
    $("#iosChromeDeepLink").href = IOS_CHROME_LINK;
    $("#openInChromeLink").href = isIOS ? IOS_CHROME_LINK : APP_URL;

    // Put url text
    $("#appLinkText").textContent = APP_URL;

    // Copy link
    $("#copyBtn").addEventListener("click", async ()=>{
      try{
        await navigator.clipboard.writeText(APP_URL);
        $("#copyBtn").textContent = "Copied ✓";
        setTimeout(()=>$("#copyBtn").textContent="Copy", 1200);
      }catch(e){ alert("Copy failed"); }
    });

    // Open Web
    $("#openBtn").addEventListener("click", ()=>{
      showOverlay(true);
      setTimeout(()=>{ window.location.href = APP_URL; }, 500);
    });

    // Install flow
    let deferredPrompt = null;
    window.addEventListener("beforeinstallprompt", (e)=>{
      e.preventDefault();
      deferredPrompt = e;
    });
    window.addEventListener("appinstalled", ()=>{
      alert("🎉 App installed successfully!");
    });

    $("#installBtn").addEventListener("click", async ()=>{
      if (isIOS){
        $("#iosGuide").style.display = "block";
        $("#troubleshoot").style.display = "none";
        return;
      }
      if (deferredPrompt){
        showOverlay(true);
        try{
          deferredPrompt.prompt();
          const choice = await deferredPrompt.userChoice;
          deferredPrompt = null;
          showOverlay(false);
          if (choice && choice.outcome === "dismissed"){
            $("#troubleshoot").style.display = "block";
          }
        }catch(err){
          showOverlay(false);
          $("#troubleshoot").style.display = "block";
          console.warn("Install failed:", err);
        }
      }else{
        $("#troubleshoot").style.display = "block";
      }
    });

    document.addEventListener("DOMContentLoaded", ()=>{
      if (isIOS){
        $("#iosGuide").style.display = "none";
      }
    });

    // Floating background hearts
    const heartsContainer = document.getElementById("hearts-container");
    for (let i=0; i<20; i++) {
      let heart = document.createElement("div");
      heart.className = "heart-float";
      heart.style.left = Math.random() * 100 + "vw";
      heart.style.animationDuration = (5 + Math.random()*7) + "s";
      heartsContainer.appendChild(heart);
    }

    // Tap hearts effect
    document.body.addEventListener("click", (e)=>{
      const heart = document.createElement("div");
      heart.className = "heart-float";
      heart.style.left = e.clientX - 9 + "px";
      heart.style.top = e.clientY - 9 + "px";
      heart.style.animationDuration = "1s";
      heart.style.opacity = 1;
      heartsContainer.appendChild(heart);
      setTimeout(()=>heart.remove(), 1000);
    });
  </script>
</body>
</html>
